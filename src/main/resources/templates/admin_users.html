<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en-GB">
<!--suppress HtmlRequiredTitleElement -->
<head
    th:replace="~{fragments/base :: head('Sporty Shoes Shop - Admin - Users')}"></head>
<body class="text-bg-light">
<header
    th:replace="~{fragments/base :: header('Sporty Shoes Shop - Admin - Users')}"></header>
<script>
  function searchUsersTable() {
    // Declare variables
    const input = document.getElementById("searchInput");
    const filter = input.value.toLowerCase();
    const table = document.getElementById("allUsers");
    const rows = table.getElementsByTagName("tr");
    let count = 0;

    // Loop through all table rows, and hide those who don't match the search query
    for (let i = 1; i < rows.length; i++) {

      const txtValue = rows[i].getAttribute("data-search");
      if (txtValue.toLowerCase().indexOf(filter) > -1) {
        rows[i].style.display = "";
        count++;
      } else {
        rows[i].style.display = "none";
      }
    }

    // Set the caption
    table.getElementsByTagName("caption")[0].innerText = count + " " + (count === 1 ? "user"
        : "users");

  }
</script>
<main>
  <div class="container ">
    <div
        th:replace="~{fragments/base :: alerts(${resultSuccess}, ${resultDanger}, ${resultInfo})}"></div>
    <hr>
    <div class="row">
      <div class="col-sm"></div>
      <div class="col-lg-8">
        <div class="form-floating mb-3">
          <input id="searchInput" type="text" class="form-control" placeholder="Search for users..."
                 aria-label="Search"
                 onkeyup="searchUsersTable()" autofocus>
          <label for="searchInput">Search for users...</label>
        </div>
        <div class="table-responsive">

          <table class="table table-hover" id="allUsers">
            <caption
                th:text="${allUsers.size() == 1 ? '1 user' : allUsers.size() + ' users'}"></caption>
            <thead>
            <tr>
              <th scope="col">Email</th>
              <th scope="col">Is Admin?</th>
              <th scope="col">No. of Orders</th>
            </tr>
            </thead>
            <tbody class="table-group-divider">
            <tr th:each="u:${allUsers}" th:data-search="${u.getEmail()}">
              <th th:text="${u.getEmail()}" scope="row"></th>
              <td>
                <input class="form-check-input opacity-100" type="checkbox"
                       th:checked="${u.getIsAdmin()}" disabled>
              </td>
              <td th:text="${u.getOrders().size()}"></td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="col-sm"></div>
    </div>
  </div>
</main>

<footer th:replace="~{fragments/base :: footer}"></footer>
</body>
</html>